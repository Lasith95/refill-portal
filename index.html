<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refill Reserve | Professional Staff Portal</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Refill">
    <link rel="manifest" href="manifest.json">

    <style>
        :root {
            --bg-body: #0f1113;
            --bg-card: #1c1f22;
            --accent: #d4af37;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --error: #e74c3c;
            /* Categories */
            --c-signature: #800000;
            --c-espresso: #6f4e37;
            --c-milk: #e67e22;
            --c-matcha: #2ecc71;
            --c-fruit: #d35400;
            --c-manual: #3498db;
            --c-batch: #7f8c8d;
            --c-tea: #34495e;
            --c-frappe: #964b00;
            --c-mojito: #1abc9c;
            --c-na: #607d8b;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            margin: 0; padding: 20px;
            line-height: 1.6;
        }

        /* Authentication Overlay */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); display: flex; justify-content: center; align-items: center; z-index: 9999;
        }
        .login-box {
            background: var(--bg-card); padding: 50px; border-radius: 4px;
            border: 1px solid var(--accent); text-align: center; width: 350px;
        }
        #passInput {
            padding: 12px; border-radius: 4px; border: 1px solid #444;
            background: #252a2e; color: white; width: 100%; margin-bottom: 20px; text-align: center;
        }

        /* Layout */
        #main-content { display: none; width: 100%; max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { font-size: 1.8rem; letter-spacing: 8px; color: var(--accent); text-transform: uppercase; margin: 0 0 25px 0; }

        /* Unified Buttons */
        .nav-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .tab-btn {
            background: transparent; border: 1px solid #444; color: var(--text-secondary);
            padding: 12px 25px; border-radius: 4px; cursor: pointer; transition: 0.3s;
            font-weight: 600; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;
        }
        .tab-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }
        .tab-btn:hover:not(.active) { border-color: var(--accent); color: var(--accent); }

        /* Category Filter Navigation */
        .category-nav {
            display: flex; justify-content: center; flex-wrap: wrap; 
            gap: 10px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #333;
        }
        .cat-filter-btn {
            background: #1c1f22; border: 1px solid #333; color: var(--text-secondary);
            padding: 8px 16px; border-radius: 2px; cursor: pointer; font-size: 0.7rem;
            text-transform: uppercase; transition: 0.2s; font-weight: bold;
        }
        .cat-filter-btn.active { border-color: var(--accent); color: var(--accent); background: #252a2e; }

        .search-container { text-align: center; margin-bottom: 30px; }
        .search-bar {
            width: 100%; max-width: 500px; padding: 14px 25px;
            background: #1c1f22; border: 1px solid #333; border-radius: 4px;
            color: white; outline: none; border-bottom: 2px solid var(--accent); font-size: 1rem;
        }

        /* Card Display */
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .card { height: 500px; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 4px; padding: 30px; }
        
        .card-front { 
            background: var(--bg-card); border: 1px solid #333; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; 
        }
        .card-back { background: #ffffff; color: #1a1a1a; transform: rotateY(180deg); overflow-y: auto; }
        
        .cat-tag { font-size: 0.65rem; padding: 4px 12px; color: white; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; border-radius: 2px; }
        .label { display: block; font-weight: 800; font-size: 0.65rem; color: #888; text-transform: uppercase; margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 2px; }
        .content { font-size: 0.95rem; color: #333; padding-top: 5px; font-weight: 400; }

        /* Quiz Layout */
        #quiz-section { display: none; max-width: 900px; margin: 0 auto; }
        .quiz-box { background: var(--bg-card); padding: 50px; border-radius: 4px; border: 1px solid #333; text-align: center; }
        .question-text { font-size: 1.6rem; margin: 25px 0; color: #fff; font-weight: 300; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .option-btn { 
            background: #15181a; border: 1px solid #333; color: white; padding: 20px; 
            border-radius: 4px; cursor: pointer; text-align: left; font-size: 0.95rem; transition: 0.2s;
        }
        .option-btn:hover { border-color: var(--accent); background: #1c1f22; }

        /* Wrong Answer Popup */
        #popup-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 10000; justify-content: center; align-items: center; 
        }
        .popup-box { background: #fff; color: #000; padding: 40px; border-radius: 4px; max-width: 600px; width: 90%; }
        
        @media (max-width: 600px) { 
            h1 { font-size: 1.4rem; }
            .nav-tabs { flex-direction: column; }
        }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color: var(--accent); letter-spacing: 4px; text-transform: uppercase; margin-bottom: 25px;">Refill Access</h2>
        <input type="password" id="passInput" placeholder="Enter Password">
        <button class="tab-btn active" style="width: 100%;" onclick="checkAuth()">Enter Dashboard</button>
    </div>
</div>

<div id="main-content">
    <header><h1>Refill Reserve</h1></header>

    <div class="nav-tabs">
        <button class="tab-btn active" id="btn-browse" onclick="showTab('browse')">Recipe Cards</button>
        <button class="tab-btn" id="btn-quiz" onclick="showTab('quiz')">Staff Quiz</button>
        <button class="tab-btn" id="btn-contact" onclick="showTab('contact')">Contact Details</button>
        <button class="tab-btn" id="btn-docs" onclick="showTab('documents')">Documents</button>
    </div>

    <div id="browse-section">
        <div class="category-nav">
            <button class="cat-filter-btn active" onclick="filterCat('All', this)">All</button>
            <button class="cat-filter-btn" onclick="filterCat('Signature', this)">Signature</button>
            <button class="cat-filter-btn" onclick="filterCat('Espresso Based', this)">Espresso</button>
            <button class="cat-filter-btn" onclick="filterCat('Milk Based', this)">Milk Based</button>
            <button class="cat-filter-btn" onclick="filterCat('Frappe', this)">Frappe</button>
            <button class="cat-filter-btn" onclick="filterCat('NA', this)">NA</button>
            <button class="cat-filter-btn" onclick="filterCat('Mojito', this)">Mojito</button>
            <button class="cat-filter-btn" onclick="filterCat('Matcha', this)">Matcha</button>
            <button class="cat-filter-btn" onclick="filterCat('Fruit & Smoothies', this)">Fruit & Smoothies</button>
            <button class="cat-filter-btn" onclick="filterCat('Pour Over', this)">Pour Over</button>
            <button class="cat-filter-btn" onclick="filterCat('Batch', this)">Batch</button>
            <button class="cat-filter-btn" onclick="filterCat('Tea', this)">Tea</button>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" class="search-bar" placeholder="Search by drink name..." onkeyup="renderCards()">
        </div>
        <div class="recipe-grid" id="recipeGrid"></div>
    </div>

    <div id="quiz-section">
        <div class="quiz-box">
            <span class="cat-tag" id="q-cat" style="background: var(--accent);">Category</span>
            <div class="question-text" id="q-text">Which ingredients belong to this drink?</div>
            <div class="options-grid" id="q-options"></div>
        </div>
    </div>

    <div id="contact-section" style="display:none;">
        <div class="recipe-grid" id="contactGrid"></div>
    </div>

    <div id="documents-section" style="display:none;">
        <div class="recipe-grid" id="docsGrid"></div>
    </div>
</div>

<div id="popup-overlay">
    <div class="popup-box">
        <h2 style="color:var(--error); margin-top:0; letter-spacing:2px;">INCORRECT</h2>
        <p>Correct Recipe for <strong><span id="p-name"></span></strong>:</p>
        <div style="text-align: left; background: #f9f9f9; padding: 20px; border-radius: 4px; border-left: 4px solid var(--accent); margin: 20px 0;">
            <span class="label">Ingredients</span><div id="p-ing" class="content"></div>
            <span class="label">Method</span><div id="p-meth" class="content"></div>
            <span class="label">Equipment</span><div id="p-eq" class="content"></div>
            <span class="label">Serving</span><div id="p-serv" class="content"></div>
        </div>
        <button class="tab-btn active" style="width: 100%;" onclick="closePopup()">I Understand - Next</button>
    </div>
</div>

<script>
const MASTER_PASS = "Refill2024";
let activeCat = "All";

const data = [
    { name: "Short Black & White", cat: "Signature", color: "var(--c-signature)", ing: "Double shot, 150ml Spanish Premix.", method: "Extract the espresso into the cup,steam the the milk,pour it gently overthe espresso,and serve with smile.", eq: "Espresso Machine.", serv: "6oz Paper Cup." },
    { name: "Iced Short Black & White", cat: "Signature", color: "var(--c-signature)", ing: "6 Ice cubes, 150ml Spanish Premix, Espresso.", method: "Fill a 6-7oz PET cup with ice,add the Spanish pre-mix,top it up with a double espresso,and serve with smile.", eq: "Espresso Machine", serv: "6-7oz Pet Cup." },
    { name: "Espresso", cat: "Espresso Based", color: "var(--c-espresso)", ing: "Double shot (35g-40g final weight).", method: "Extract at 9 Bar(92°C, 9 Bar). Use approved timing/dose for grinder.", eq: "Espresso Machine.", serv: "Demitasse/4oz Paper Cup." },
    { name: "Americano", cat: "Espresso Based", color: "var(--c-espresso)", ing: "Double shot, Hot Water.", method: "Combine double shot of espresso with water(80-90°C Water).", eq: "Espresso Machine", serv: "8oz Paper Cup." },
    { name: "Black & White", cat: "Milk Based", color: "var(--c-milk)", ing: "Double shot, 200ml Spanish Premix.", method: "Steam premix to 55°C. Pull double espresso shot.", eq: "Espresso Machine.", serv: "8oz Paper Cup." },
    { name: "Iced Black & White", cat: "Milk Based", color: "var(--c-milk)", ing: "6 Ice cubes, 200ml Spanish Premix, Espresso 35g-40g.", method: "Mix premix well. Add ice, then espresso.", eq: "12oz Glass.", serv: "Signature layered look." },
    { name: "Latte", cat: "Milk Based", color: "var(--c-milk)", ing: "Double shot, Full fat milk.", method: "Steam milk at 55°C. Create 2-3mm microfoam.", eq: "Steam wand.", serv: "Latte art required." },
    { name: "Flat White", cat: "Milk Based", color: "var(--c-milk)", ing: "Double shot, Full fat milk.", method: "Steam milk at 55°C. 2-3mm microfoam.", eq: "6oz Ceramic cup.", serv: "Microfoam finish." },
    { name: "Cappuccino", cat: "Milk Based", color: "var(--c-milk)", ing: "Double shot, Full fat milk.", method: "Steam milk at 55°C. Thicker 4-5mm foam.", eq: "6oz Ceramic cup.", serv: "Centered foam art." },
    { name: "Cortado", cat: "Milk Based", color: "var(--c-milk)", ing: "Double shot, Full fat milk.", method: "Equal parts espresso and milk (1:1 ratio).", eq: "4.5oz Glass.", serv: "Balanced texture." },
    { name: "Piccolo", cat: "Milk Based", color: "var(--c-milk)", ing: "Ristretto (20g-25g), Full fat milk.", method: "Steam milk at 55°C. Add to ristretto shot.", eq: "3.5oz Glass.", serv: "Intense milk profile." },
    { name: "Mocha", cat: "Milk Based", color: "var(--c-milk)", ing: "Double shot, 10g Cacao, 200ml Spanish Premix.", method: "Mix cacao with espresso. Add steamed milk.", eq: "Steam wand.", serv: "Rich chocolate finish." },
    { name: "Iced Latte", cat: "Milk Based", color: "var(--c-milk)", ing: "6 Ice, Full fat milk, Double shot espresso.", method: "Add ice, milk, then top with espresso.", eq: "12oz Glass.", serv: "Natural layering." },
    { name: "Iced Mocha Latte", cat: "Milk Based", color: "var(--c-milk)", ing: "6 Ice, 200ml Spanish Premix, Espresso.", method: "Mix premix thoroughly. Add ice, then espresso.", eq: "12oz Glass.", serv: "Gently stirred." },
    { name: "Creamy Espresso", cat: "Frappe", color: "var(--c-frappe)", ing: "Espresso, 20ml Caramel, 10ml Cream, 50g Ice cream.", method: "Mix caramel and espresso. Blend with cream and ice cream.", eq: "Blender.", serv: "Dessert profile." },
    { name: "Cloud Matcha", cat: "Matcha", color: "var(--c-matcha)", ing: "4g Matcha, 40g Water, 50g Cream, 30g Spanish Milk, 130g Coconut Water.", method: "Whisk matcha. Shake cream/milk. Layer over coconut water.", eq: "Whisk & Shaker.", serv: "Distinct layers." },
    { name: "Coco Matcha", cat: "Matcha", color: "var(--c-matcha)", ing: "40g Matcha (prepped), 50g Cream, 35g Coconut Syrup, 150g Coconut Milk.", method: "Mix matcha/cream. Layer over coconut milk base.", eq: "Whisk & Shaker.", serv: "Tropical finish." },
    { name: "Strawberry Matcha Latte", cat: "Matcha", color: "var(--c-matcha)", ing: "4g Matcha, 20g Strawberry Puree, 150g Coconut Milk, 10g Vanilla Syrup.", method: "Layer puree, ice, milk, then top with whisked matcha.", eq: "Whisk.", serv: "Garnish: Strawberry slice." },
    { name: "Green Shot", cat: "Frappe", color: "var(--c-frappe)", ing: "2 scoops Ice cream, 40g Pistachio puree, 20g Spanish milk, Espresso.", method: "Blend all ingredients until smooth.", eq: "Blender.", serv: "Pistachio profile." },
    { name: "Mango Crunchy", cat: "Frappe", color: "var(--c-frappe)", ing: "3 scoops Ice cream, 70ml Milk, 50g Mango puree, 2 tsp Biscuit powder.", method: "Blend liquid/ice cream. Biscuit at base and top.", eq: "Blender.", serv: "Crunchy topping." },
    { name: "Refill Passion Breeze", cat: "Mojito", color: "var(--c-mojito)", ing: "40ml Strawberry syrup, 10ml Lime, 10ml Simple syrup, 6-8 Mint, Soda.", method: "Muddle mint/lime. Add syrup, ice, then soda.", eq: "Muddler.", serv: "Garnish: Mint/Lime/Strawberry." },
    { name: "Acai Smoothies", cat: "Fruit & Smoothies", color: "var(--c-fruit)", ing: "180g Acai, 1/2 Banana, Berries, Peanut butter, Granola.", method: "Blend acai/fruit/PB until thick.", eq: "Blender.", serv: "Top with granola." },
    { name: "Refill Fruit Shake", cat: "Fruit & Smoothies", color: "var(--c-fruit)", ing: "150g Strawberries, 1 Banana, 240ml Milk, 120ml Yogurt, 15ml Honey.", method: "Blend all until perfectly smooth.", eq: "Blender.", serv: "Freshly blended." },
    { name: "Green Smoothie", cat: "Mojito", color: "var(--c-mojito)", ing: "30ml Green Apple, 30ml Lemon Mint, 5ml Lime, Soda.", method: "Mix purees/lime. Fill cup with ice/soda. Top with mix.", eq: "Shaker.", serv: "Garnish: Lime/Mint." },
    { name: "Cloudy Chocolate", cat: "NA", color: "var(--c-na)", ing: "150ml Coconut water, Chocolate foam (7g powder, 60ml cream).", method: "Whisk chocolate foam. Pour over iced coconut water.", eq: "Whisk.", serv: "Layered visual." },
    { name: "Hot V60", cat: "Pour Over", color: "var(--c-manual)", ing: "16g Coffee, 240g-256g Water.", method: "Ratio 1:15-16. 4-stage pour. Spiral motion.", eq: "V60, 92°C.", serv: "Clean & Clear." },
    { name: "Iced V60", cat: "Pour Over", color: "var(--c-manual)", ing: "24g Coffee, 200g Water, 170g Ice.", method: "Spiral pour on 200g water. Swirl dripper at end.", eq: "V60, 92°C.", serv: "Chilled." },
    { name: "Hot Chemex", cat: "Pour Over", color: "var(--c-manual)", ing: "18g Coffee, 270g Water.", method: "Ratio 1:15. 4-stage pour. 3:00 minute extraction.", eq: "Chemex, 92°C.", serv: "Filter cup." },
    { name: "Aeropress", cat: "Pour Over", color: "var(--c-manual)", ing: "25g Coffee, 250g Water.", method: "Ratio 1:10. Bloom, stir, press at 2:00 mark.", eq: "Aeropress.", serv: "Full-bodied." },
    { name: "Spanish Premix", cat: "Batch", color: "var(--c-batch)", ing: "500g Sweetened Condensed Milk, 2000g Double Cream Milk.", method: "Combine both milks. Whisk thoroughly until integrated.", eq: "Whisk, Storage Container.", serv: "Store at 4°C." },
    { name: "Batch Brew", cat: "Batch", color: "var(--c-batch)", ing: "330g-350g Coffee, 6L Water max.", method: "Ratio 1:17-18. Medium-Coarse grind.", eq: "Batch Brewer.", serv: "Automatic." },
    { name: "Cold Brew", cat: "Batch", color: "var(--c-batch)", ing: "1kg Coffee, 10L Water.", method: "Ratio 1:10. Steep 24h at room temp.", eq: "Toddy System.", serv: "Store at 4°C." },
    { name: "Hibiscus", cat: "Batch", color: "var(--c-batch)", ing: "Hibiscus, Water (1:14), Sugar (1:1.5).", method: "Brew in Toddy with 94°C water for 24 hours.", eq: "Toddy.", serv: "Floral & Sweet." },
    { name: "Darjeeling Tea", cat: "Tea", color: "var(--c-tea)", ing: "2.5g Tea leaves.", method: "85-90°C Water. Steep for 3 minutes.", eq: "Teapot.", serv: "Hot." },
    { name: "Rose Oolong Tea", cat: "Tea", color: "var(--c-tea)", ing: "2.5g Tea.", method: "90°C Water. Steep 4 min.", eq: "Teapot.", serv: "Floral." },
    { name: "Yunnan Earl Grey", cat: "Tea", color: "var(--c-tea)", ing: "2.5g Tea.", method: "95°C Water. Steep for 3-4 minutes.", eq: "Teapot.", serv: "Bold." },
    { name: "Tropical Rooibos", cat: "Tea", color: "var(--c-tea)", ing: "3g Tea.", method: "Boiling water (100°C). Steep for 5-6 minutes.", eq: "Teapot.", serv: "Herbal." },
    { name: "Peach & Pear Tea", cat: "Tea", color: "var(--c-tea)", ing: "3g Tea.", method: "100°C Water. Steep for 4-5 minutes.", eq: "Teapot.", serv: "Fruity." },
    { name: "Prickly Cactus Tea", cat: "Tea", color: "var(--c-tea)", ing: "3g Tea.", method: "Boiling water. Steep 5-6 min.", eq: "Teapot.", serv: "Exotic." },
    { name: "Jasmine Sapphire Tea", cat: "Tea", color: "var(--c-tea)", ing: "2.5g Tea.", method: "80-85°C Water. Steep for 2-3 minutes.", eq: "Teapot.", serv: "Light/Floral." }
];

const contactData = [
    { name: "Shashikant Joshi", role: "Operations Manager", location: "Refill Reserve", phone: "0528797089" },
    { name: "Saad Khan", role: "Operations Manager", location: "Refill Roastery", phone: "0565460813" },
    { name: "Rolly Celzo", role: "HR Manager", location: "Refill Roastery/Reserve", phone: "0565460812" },
    { name: "Ajit Tamang", role: "QC", location: "Refill Roastery/Reserve", phone: "0544640259" },
    { name: "Washiq", role: "Junior Accountant", location: "Refill Roastery/Reserve", phone: "0569608981" },
    { name: "Refill Roastery - Hilli", role: "Branch Contact", location: "Hilli", phone: "037531351" },
    { name: "Refill Reserve - Hilli", role: "Branch Contact", location: "Hilli", phone: "037366307" }
];

const docData = [
    { name: "Hand book", description: "Official staff guidelines and protocol.", file: "handbook.pdf" },
    { name: "Leave application form", description: "Standard form for leave requests.", file: "https://drive.google.com/uc?export=download&id=1S3HEygyR1R8cVAzNKlb86m1jTSSjI5rh&authuser=2" },
    { name: "Salary advance form", description: "Official form for salary advance requests.", file: "https://drive.google.com/uc?export=download&id=14perFQsSMCfTMP4Y2SOuWpzh3w_VSoh3" }
];

function checkAuth() {
    if(document.getElementById('passInput').value === MASTER_PASS) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        renderCards();
    }
}

function showTab(view) {
    document.getElementById('browse-section').style.display = (view === 'browse') ? 'block' : 'none';
    document.getElementById('quiz-section').style.display = (view === 'quiz') ? 'block' : 'none';
    document.getElementById('contact-section').style.display = (view === 'contact') ? 'block' : 'none';
    document.getElementById('documents-section').style.display = (view === 'documents') ? 'block' : 'none';
    
    document.getElementById('btn-browse').classList.toggle('active', view === 'browse');
    document.getElementById('btn-quiz').classList.toggle('active', view === 'quiz');
    document.getElementById('btn-contact').classList.toggle('active', view === 'contact');
    document.getElementById('btn-docs').classList.toggle('active', view === 'documents');
    
    if(view === 'quiz') startNewQuestion();
    if(view === 'contact') renderContacts();
    if(view === 'documents') renderDocuments();
}

function filterCat(cat, btn) {
    activeCat = cat;
    document.querySelectorAll('.cat-filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderCards();
}

function renderDocuments() {
    const grid = document.getElementById('docsGrid');
    grid.innerHTML = '';
    docData.forEach(d => {
        const isHandbook = d.name === "Hand book";
        const btnText = isHandbook ? "Open & Read" : "Download Form";
        
        // This helps mobile browsers understand they should try to view it first
        const btnAttr = isHandbook ? 'target="_blank" rel="noopener noreferrer"' : 'download';

        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="card-inner">
                <div class="card-front">
                    <span class="cat-tag" style="background:var(--accent); color:#000;">REFILL DOCS</span>
                    <h2 style="font-weight:400; letter-spacing:1px; margin-bottom:15px;">${d.name}</h2>
                    <p style="color:var(--text-secondary); margin:0; font-size:0.8rem; padding: 0 20px;">${d.description}</p>
                    <div style="margin-top:40px; width: 80%;">
                        <a href="${d.file}" ${btnAttr} style="background:var(--accent); color:#000; padding:15px; border-radius:4px; text-decoration:none; font-weight:bold; font-size:0.8rem; text-transform:uppercase; display:block; text-align: center;">${btnText}</a>
                    </div>
                </div>
            </div>`;
        grid.appendChild(div);
    });
}

function renderContacts() {
    const grid = document.getElementById('contactGrid');
    grid.innerHTML = '';
    contactData.forEach(c => {
        const tagLabel = (c.role === "Branch Contact") ? "BRANCH CONTACT" : "STAFF CONTACT";
        const isMobile = c.phone.startsWith('05');
        const waLink = "https://wa.me/971" + c.phone.substring(1);
        const div = document.createElement('div');
        div.className = 'card';
        div.onclick = (e) => {
            if(e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A') {
                div.classList.toggle('flipped');
            }
        };
        div.innerHTML = `
            <div class="card-inner">
                <div class="card-front">
                    <span class="cat-tag" style="background:var(--accent); color:#000;">${tagLabel}</span>
                    <h2 style="font-weight:400; letter-spacing:1px; margin-bottom:5px;">${c.name}</h2>
                    <p style="color:var(--text-secondary); margin:0; font-size:0.8rem; text-transform:uppercase;">${c.role}</p>
                    <p style="color:var(--accent); font-size:0.7rem; margin-top:10px; font-weight:bold;">${c.location}</p>
                </div>
                <div class="card-back">
                    <h3 style="margin:0; font-size:1rem; color:var(--accent); border-bottom:1px solid #eee; padding-bottom:5px;">${c.name}</h3>
                    <span class="label">Designation</span><div class="content">${c.role}</div>
                    <span class="label">Location</span><div class="content">${c.location}</div>
                    <span class="label">Mobile Number</span>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;">
                        <div class="content" style="font-size:1.4rem; font-weight:bold; color:#000;">${c.phone}</div>
                        <button onclick="copyNumber('${c.phone}', this)" style="background: #eee; border: 1px solid #ccc; padding: 5px 10px; border-radius: 4px; font-size: 0.6rem; cursor: pointer;">COPY</button>
                    </div>
                    <div style="margin-top:30px; display: flex; flex-direction: column; gap: 10px; align-items: center;">
                        <a href="tel:${c.phone}" style="background:var(--accent); color:#000; padding:12px 25px; border-radius:4px; text-decoration:none; font-weight:bold; font-size:0.8rem; text-transform:uppercase; width: 85%; text-align: center;">Direct Call</a>
                        ${isMobile ? `<a href="${waLink}" target="_blank" style="background:#25D366; color:#fff; padding:12px 25px; border-radius:4px; text-decoration:none; font-weight:bold; font-size:0.8rem; text-transform:uppercase; width: 85%; text-align: center;">WhatsApp</a>` : ''}
                    </div>
                </div>
            </div>`;
        grid.appendChild(div);
    });
}

function renderDocuments() {
    const grid = document.getElementById('docsGrid');
    grid.innerHTML = '';
    docData.forEach(d => {
        // Condition to change behavior for "Hand book"
        const isRead = d.name === "Hand book";
        const btnText = isRead ? "Open & Read" : "Download File";
        
        // If it's the handbook, we only want to open it in a new window (target="_blank")
        // If it's a form, we include the 'download' attribute
        const btnAttr = isRead ? 'target="_blank"' : 'download';

        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="card-inner">
                <div class="card-front">
                    <span class="cat-tag" style="background:var(--accent); color:#000;">REFILL DOCS</span>
                    <h2 style="font-weight:400; letter-spacing:1px; margin-bottom:15px;">${d.name}</h2>
                    <p style="color:var(--text-secondary); margin:0; font-size:0.8rem; padding: 0 20px;">${d.description}</p>
                    <div style="margin-top:40px; width: 80%;">
                        <a href="${d.file}" ${btnAttr} style="background:var(--accent); color:#000; padding:15px; border-radius:4px; text-decoration:none; font-weight:bold; font-size:0.8rem; text-transform:uppercase; display:block; text-align: center;">${btnText}</a>
                    </div>
                </div>
            </div>`;
        grid.appendChild(div);
    });
}

function copyNumber(num, btn) {
    navigator.clipboard.writeText(num).then(() => {
        btn.innerText = "COPIED!";
        setTimeout(() => { btn.innerText = "COPY"; }, 2000);
    });
}

let currentQ = null;
function startNewQuestion() {
    currentQ = data[Math.floor(Math.random() * data.length)];
    document.getElementById('q-cat').innerText = currentQ.cat;
    document.getElementById('q-cat').style.background = currentQ.color;
    document.getElementById('q-text').innerText = `Identify the ingredients for: ${currentQ.name}`;
    let options = [currentQ.ing];
    while(options.length < 4) {
        let r = data[Math.floor(Math.random() * data.length)].ing;
        if(!options.includes(r)) options.push(r);
    }
    options.sort(() => Math.random() - 0.5);
    const container = document.getElementById('q-options');
    container.innerHTML = '';
    options.forEach(opt => {
        const b = document.createElement('button');
        b.className = 'option-btn';
        b.innerText = opt;
        b.onclick = () => (opt === currentQ.ing) ? startNewQuestion() : showPopup();
        container.appendChild(b);
    });
}

function showPopup() {
    document.getElementById('p-name').innerText = currentQ.name;
    document.getElementById('p-ing').innerText = currentQ.ing;
    document.getElementById('p-meth').innerText = currentQ.method;
    document.getElementById('p-eq').innerText = currentQ.eq;
    document.getElementById('p-serv').innerText = currentQ.serv;
    document.getElementById('popup-overlay').style.display = 'flex';
}

function closePopup() {
    document.getElementById('popup-overlay').style.display = 'none';
    startNewQuestion();
}
</script>
</body>
</html>